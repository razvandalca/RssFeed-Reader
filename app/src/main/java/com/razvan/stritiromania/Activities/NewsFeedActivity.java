package com.razvan.stritiromania.Activities;import android.content.Context;import android.content.Intent;import android.net.ConnectivityManager;import android.net.NetworkInfo;import android.net.Uri;import android.os.Bundle;import android.support.design.widget.Snackbar;import android.support.v7.app.AppCompatActivity;import android.util.Log;import android.view.View;import com.einmalfel.earl.Item;import com.razvan.stritiromania.Managers.Manager;import com.razvan.stritiromania.Pojos.Models.NewsFeedModel;import com.razvan.stritiromania.R;import com.razvan.stritiromania.Views.NewsFeedLayout;import org.xmlpull.v1.XmlPullParserException;import java.io.IOException;import java.util.List;import java.util.zip.DataFormatException;public class NewsFeedActivity extends AppCompatActivity  {    private String TAG = "News Feed Activity";    private NewsFeedLayout rootLayout;    private NewsFeedModel rootModel;    private Intent shareIntent = new Intent();    private String URLFORTEST="http://rss.realitatea.net/local.xml";    NewsFeedLayout.ViewListener viewListener=new NewsFeedLayout.ViewListener() {        @Override        public void onShareClicked(String URL,String title) {            shareIntent.setAction(Intent.ACTION_SEND);            shareIntent.setType("text/plain");            shareIntent.putExtra(Intent.EXTRA_TEXT, title+" -> "+URL);            startActivity(Intent.createChooser(shareIntent, "Distribuie prin:"));        }        @Override        public void onFavoriteClicked(Item item) {            Manager manger=Manager.getInstance(getApplicationContext());            Snackbar snackbar = Snackbar                    .make(rootLayout, "Articol  adaugat la FAVORITE !", Snackbar.LENGTH_LONG)                    .setAction("UNDO", new View.OnClickListener() {                        @Override                        public void onClick(View view) {                            Snackbar snackbar1 = Snackbar.make(rootLayout, "Articol sters de la FAVORITE !", Snackbar.LENGTH_LONG);                            snackbar1.show();                        }                    });            manger.getDbManager().addToFavorites(item);            Log.e(TAG, "onFavoriteClicked: " +manger.getDbManager().itemExistsinFavorites(item));            List<com.razvan.stritiromania.Pojos.Item> items= manger.getDbManager().getAllFavorites();            for(int i=0 ; i<items.size();i++){                Log.e(TAG, "onFavoriteClicked: "+i+" ->" + items.get(i).toString() );            }            snackbar.show();        }        @Override        public void onOpenCliked(String URL) {            Intent browserIntent = new Intent(Intent.ACTION_VIEW, Uri.parse(URL));            startActivity(browserIntent);        }    };    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        initModel();        initLayout();        setModelToLayout();        if(isConected()) {            rootLayout.getNoInternet().setVisibility(View.GONE);            populateNewsFeed();        }else{            rootLayout.setVisibility(View.VISIBLE);        }    }    private void initLayout(){        rootLayout= (NewsFeedLayout) View.inflate(this, R.layout.activity_news_feed, null);        rootLayout.setContext(NewsFeedActivity.this);        rootLayout.setViewListener(viewListener);        setContentView(rootLayout);        rootModel.addListener(rootLayout);    }    private void initModel() {        if (rootModel == null) {            rootModel = new NewsFeedModel();        }    }    private void setModelToLayout(){        if(rootModel!=null&&rootLayout!=null) {            rootLayout.setRootModel(rootModel);        }    }    private void populateNewsFeed(){        Thread initModelThread =new Thread(new Runnable() {            @Override            public void run() {                try {                    rootModel.setItemsList(Manager.getInstance(getApplicationContext()).getRssFeedManager().readFeed(URLFORTEST));                } catch (XmlPullParserException e) {                    e.printStackTrace();                } catch (IOException e) {                    e.printStackTrace();                } catch (DataFormatException e) {                    e.printStackTrace();                }            }        });        initModelThread.setPriority(Thread.MAX_PRIORITY);        initModelThread.start();    }    private boolean isConected(){        ConnectivityManager cm = (ConnectivityManager)this.getSystemService(Context.CONNECTIVITY_SERVICE);        NetworkInfo activeNetwork = cm.getActiveNetworkInfo();        return  activeNetwork != null && activeNetwork.isConnectedOrConnecting();    }}